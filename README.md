# Kontaktai (saugesnis variantas)

Sis variantas yra saugesnis uz tiesiogini jungima is frontendo i Supabase, nes:
- `SUPABASE_SERVICE_ROLE_KEY` laikomas tik serverio aplinkoje.
- Frontende nera nei `anon`, nei `service_role` raktu.
- API tikrina `Origin`, `POST` metoda, lauku formata ir honeypot lauka.

## Architektura

1. Frontendas (`index.html`, `app.js`) hostinamas GitHub Pages.
2. API (`api/contact.js`) hostinama Vercel.
3. API iraso i Supabase `contacts` lentele su `service_role` raktu.

## 1) Supabase lentele

SQL Editor paleisk:

```sql
create table if not exists public.contacts (
  id bigint generated by default as identity primary key,
  name text not null check (char_length(name) between 2 and 80),
  email text not null check (char_length(email) <= 160),
  message text not null check (char_length(message) between 3 and 2000),
  created_at timestamptz not null default now()
);

alter table public.contacts enable row level security;
```

Pastaba: anon insert policy nebereikalinga, nes irasymas vyksta per serveri.

## 2) API diegimas Vercel

1. Sukurk atskira GitHub repo su sio aplanko turiniu.
2. Vercel -> `Add New Project` -> importuok ta repo.
3. Vercel `Environment Variables` pridek:
- `SUPABASE_URL` = tavo Supabase project URL
- `SUPABASE_SERVICE_ROLE_KEY` = tavo Supabase service role key
- `ALLOWED_ORIGIN` = tavo frontend URL, pvz. `https://TAVO_VARDAS.github.io`
4. Deploy.
5. Po deploy gauk API baze, pvz. `https://kontaktai-api.vercel.app`.

## 3) Frontendo konfig

Faile `config.js` irasyk:

```js
window.APP_CONFIG = {
  apiBaseUrl: "https://kontaktai-api.vercel.app"
};
```

## 4) GitHub Pages

1. GitHub repo -> `Settings` -> `Pages`
2. `Source: Deploy from a branch`
3. Branch `main`, folder `/ (root)`
4. Palauk 1-2 min ir atidaryk publikuota URL.

## Saugumo pastabos

- Nelaikyk `SUPABASE_SERVICE_ROLE_KEY` jokiuose frontend failuose.
- `ALLOWED_ORIGIN` laikyk tikslia frontend domeno reiksme.
- Jei noresi dar stipresnes apsaugos nuo botu, pridek CAPTCHA (Turnstile/hCaptcha) ir tikrink tokena API faile.
